# 簡単な使い方ガイド

Redmine MCPサーバーを実際に使ってみよう！このガイドでは、コピペで動くレベルの実例を中心に説明します。

## 🚀 基本的な使い方

Redmine MCPサーバーには2つの使い方があります：

- **STDIO版**: VS Code拡張機能などで使用
- **HTTP版**: 開発・デバッグ用（curlやPostmanで直接アクセス）

## 📋 事前準備

### 環境変数の設定

```bash
# Redmineサーバーの設定
export REDMINE_URL="http://localhost:8080"
export REDMINE_API_KEY="your_api_key_here"
```

### サーバーの起動

```bash
# HTTPサーバーを起動（開発・テスト用）
ruby server.rb

# または、STDIO版（VS Code拡張機能用）
ruby stdio_server.rb
```

## 🎯 チケットを取得してみる

### curlで取得する場合

まずはチケット#123を取得してみましょう：

```bash
curl -X POST http://localhost:3000/rpc \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "id": 1,
    "method": "tools/call",
    "params": {
      "name": "get_redmine_ticket",
      "arguments": {
        "ticket_id": "123"
      }
    }
  }'
```

### 結果の見方

成功した場合、以下のような結果が返ってきます：

```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "result": {
    "content": [
      {
        "type": "text",
        "text": "チケット情報 #123:\n{\n  \"id\": 123,\n  \"project\": {\n    \"id\": 1,\n    \"name\": \"マイプロジェクト\"\n  },\n  \"tracker\": {\n    \"id\": 1,\n    \"name\": \"バグ\"\n  },\n  \"status\": {\n    \"id\": 1,\n    \"name\": \"新規\"\n  },\n  \"subject\": \"ログインできない問題\",\n  \"description\": \"ユーザーがログイン時にエラーが発生する\",\n  \"created_on\": \"2024-01-15T10:30:00Z\"\n}"
      }
    ]
  }
}
```

**重要な情報**：
- `id`: チケット番号
- `subject`: チケットのタイトル
- `description`: 詳細説明
- `status`: 現在のステータス
- `tracker`: チケットの種類（バグ、機能、タスクなど）

### STDIO版で取得する場合

```bash
echo '{"jsonrpc":"2.0","id":1,"method":"tools/call","params":{"name":"get_redmine_ticket","arguments":{"ticket_id":"123"}}}' | ruby stdio_server.rb
```

## ✨ チケットを作成してみる

### 最小構成でチケット作成

新しいチケットを作成する最も簡単な方法：

```bash
curl -X POST http://localhost:3000/rpc \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "id": 2,
    "method": "tools/call",
    "params": {
      "name": "create_redmine_ticket",
      "arguments": {
        "project_id": "1",
        "subject": "新しいバグ報告"
      }
    }
  }'
```

### 詳細なチケット作成

より詳しい情報を含むチケットを作成：

```bash
curl -X POST http://localhost:3000/rpc \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "id": 3,
    "method": "tools/call",
    "params": {
      "name": "create_redmine_ticket",
      "arguments": {
        "project_name": "マイプロジェクト",
        "subject": "パスワードリセット機能の不具合",
        "description": "パスワードリセットメールが届かない問題が発生しています。\n\n再現手順:\n1. パスワードリセットページにアクセス\n2. メールアドレスを入力\n3. 送信ボタンをクリック\n4. メールが届かない",
        "tracker_id": "1",
        "priority_id": "4"
      }
    }
  }'
```

### 作成結果の確認

成功した場合：

```json
{
  "jsonrpc": "2.0",
  "id": 3,
  "result": {
    "content": [
      {
        "type": "text",
        "text": "チケットを作成しました #456: パスワードリセット機能の不具合"
      }
    ]
  }
}
```

作成されたチケット番号（この例では#456）が返ってくるので、メモしておきましょう。

## 💻 VS Codeで使ってみる

### MCP設定ファイルの作成

VS Codeでの使用には、設定ファイルが必要です：

```json
{
  "mcpServers": {
    "redmine": {
      "command": "ruby",
      "args": ["/path/to/your/redmine_mcp/stdio_server.rb"],
      "env": {
        "REDMINE_URL": "http://localhost:8080",
        "REDMINE_API_KEY": "your_api_key_here"
      }
    }
  }
}
```

### Claude Code での使用例

VS Code拡張機能で、以下のようにAIに依頼できます：

```
「チケット#123の情報を教えて」
「新しいバグレポートをチケット#123と同じプロジェクトに作成して」
「チケット#456の詳細を確認して、類似の問題がないか調べて」
```

## 🔄 よくある使い方のパターン

### パターン1: バグ調査ワークフロー

1. **チケット情報取得**:
   ```bash
   # チケット#123の詳細確認
   curl -X POST http://localhost:3000/rpc -H "Content-Type: application/json" -d '{"jsonrpc":"2.0","id":1,"method":"tools/call","params":{"name":"get_redmine_ticket","arguments":{"ticket_id":"123"}}}'
   ```

2. **関連チケット作成**:
   ```bash
   # 同じプロジェクトに新しい調査チケットを作成
   curl -X POST http://localhost:3000/rpc -H "Content-Type: application/json" -d '{"jsonrpc":"2.0","id":2,"method":"tools/call","params":{"name":"create_redmine_ticket","arguments":{"project_id":"1","subject":"チケット#123の調査タスク","description":"元のバグ：[チケット#123の内容をここに記載]"}}}'
   ```

### パターン2: 定期レポート作成

複数のチケットを順番に確認：

```bash
# チケット#100
curl -X POST http://localhost:3000/rpc -H "Content-Type: application/json" -d '{"jsonrpc":"2.0","id":1,"method":"tools/call","params":{"name":"get_redmine_ticket","arguments":{"ticket_id":"100"}}}'

# チケット#101
curl -X POST http://localhost:3000/rpc -H "Content-Type: application/json" -d '{"jsonrpc":"2.0","id":2,"method":"tools/call","params":{"name":"get_redmine_ticket","arguments":{"ticket_id":"101"}}}'

# チケット#102
curl -X POST http://localhost:3000/rpc -H "Content-Type: application/json" -d '{"jsonrpc":"2.0","id":3,"method":"tools/call","params":{"name":"get_redmine_ticket","arguments":{"ticket_id":"102"}}}'
```

### パターン3: バッチ処理での活用

簡単なシェルスクリプトで複数チケットの確認：

```bash
#!/bin/bash
# チケット確認スクリプト

TICKETS=(123 124 125 126 127)

for ticket in "${TICKETS[@]}"; do
  echo "=== チケット#${ticket} ==="
  curl -s -X POST http://localhost:3000/rpc \
    -H "Content-Type: application/json" \
    -d "{\"jsonrpc\":\"2.0\",\"id\":1,\"method\":\"tools/call\",\"params\":{\"name\":\"get_redmine_ticket\",\"arguments\":{\"ticket_id\":\"${ticket}\"}}}" \
    | jq -r '.result.content[0].text'
  echo ""
done
```

## ❗ エラーが出た時は

### よくあるエラーと対処法

#### 1. 「チケットが見つかりません」エラー

```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "error": {
    "code": -32000,
    "message": "APIエラー: チケット#999が見つかりません"
  }
}
```

**対処法**:
- チケット番号が正しいか確認
- 削除されたチケットの可能性
- アクセス権限があるか確認

#### 2. 認証エラー

```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "error": {
    "code": -32000,
    "message": "APIエラー: 認証に失敗しました。APIキーを確認してください"
  }
}
```

**対処法**:
```bash
# 環境変数の確認
echo $REDMINE_API_KEY
echo $REDMINE_URL

# 正しいAPIキーの設定
export REDMINE_API_KEY="正しいAPIキーをここに"
```

#### 3. サーバーに接続できない

```bash
curl: (7) Failed to connect to localhost port 3000: Connection refused
```

**対処法**:
```bash
# サーバーが起動しているか確認
ps aux | grep ruby

# サーバーを起動
ruby server.rb
```

#### 4. パラメータエラー

```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "error": {
    "code": -32602,
    "message": "チケットIDが指定されていません"
  }
}
```

**対処法**:
- リクエストのJSONに`ticket_id`が含まれているか確認
- JSONの構文が正しいか確認

### デバッグのコツ

#### 1. JSON形式の確認

```bash
# jqコマンドでJSON形式をチェック
echo '{"jsonrpc":"2.0","id":1,"method":"tools/call"}' | jq .
```

#### 2. サーバーログの確認

```bash
# サーバーを起動してログを確認
ruby server.rb
# 別のターミナルでリクエストを送信してログを見る
```

#### 3. 段階的なテスト

1. まず初期化から試す：
   ```bash
   curl -X POST http://localhost:3000/rpc -H "Content-Type: application/json" -d '{"jsonrpc":"2.0","id":1,"method":"initialize"}'
   ```

2. 次に利用可能ツールを確認：
   ```bash
   curl -X POST http://localhost:3000/rpc -H "Content-Type: application/json" -d '{"jsonrpc":"2.0","id":2,"method":"tools/list"}'
   ```

3. 最後に実際のツールを実行：
   ```bash
   curl -X POST http://localhost:3000/rpc -H "Content-Type: application/json" -d '{"jsonrpc":"2.0","id":3,"method":"tools/call","params":{"name":"get_redmine_ticket","arguments":{"ticket_id":"123"}}}'
   ```

## 🔍 応用例

### AIと組み合わせた活用

Claude Code（VS Code拡張機能）と組み合わせると、以下のような活用ができます：

1. **チケット分析**: 「チケット#123の問題を分析して、解決策を提案して」
2. **関連性チェック**: 「チケット#123と#124の関連性を調べて」
3. **進捗レポート**: 「プロジェクトの進捗をチケット情報から分析して」

### データ活用のヒント

取得したチケット情報は以下の用途に活用できます：

- **トレンド分析**: バグの発生パターン分析
- **工数見積もり**: 過去の類似チケット参考
- **品質管理**: 不具合の傾向分析
- **チーム効率**: 解決時間の分析

## 📚 次のステップ

このガイドでRedmine MCPサーバーの基本的な使い方を理解できたら、以下の資料も参考にしてください：

- **詳細仕様**: [API.md](../API.md) - 全ての機能の詳細
- **トラブルシューティング**: [TROUBLESHOOTING.md](../TROUBLESHOOTING.md) - より詳しい問題解決
- **開発者向け**: [DEVELOPMENT.md](../DEVELOPMENT.md) - カスタマイズや拡張

実際に動かしながら学ぶのが一番です。まずは簡単なチケット取得から始めて、徐々に複雑な使い方に挑戦してみてください！