# はじめてのRedmine MCPサーバーセットアップ

## このガイドについて

このガイドでは、プログラミング初心者の方でも安心してRedmine MCPサーバーを動かせるよう、一歩ずつ丁寧に説明します。

**Redmine MCPサーバーとは？**
- AIがRedmine（プロジェクト管理システム）のチケット情報を読み取れるようにするツールです
- Redmineのチケットを、AIと自然に会話しながら確認できるようになります

**所要時間**: 約30～60分（ダウンロード時間によります）

## 必要なもの

このプロジェクトを動かすために、以下のツールが必要です：

### 必須ツール

1. **Ruby 3.3以上** 📦
   - このプロジェクトで使用するプログラミング言語
   - バージョン3.3以上が必要です

2. **Git** 🌿
   - プログラムのファイルをダウンロードするためのツール
   - GitHubからプロジェクトを取得します

3. **Docker & Docker Compose** 🐳
   - 開発用のRedmine環境を簡単に作るためのツール
   - 難しい設定なしでRedmineが使えるようになります

4. **テキストエディタ** ✏️
   - VS Code がおすすめです（無料）
   - プログラムのファイルを編集できればどれでもOK

### システム要件

- **メモリ**: 4GB以上（Dockerを使うため）
- **空き容量**: 2GB以上
- **ネットワーク**: インターネット接続（ファイルのダウンロード用）

---

## ステップ1: Rubyの準備

### 1-1. Rubyがインストールされているか確認

まず、お使いのパソコンにRubyがインストールされているか確認しましょう。

**Windowsの場合:**
1. スタートメニューから「cmd」または「PowerShell」を開きます
2. 以下のコマンドを入力してEnterキーを押します：

```bash
ruby --version
```

**Mac/Linuxの場合:**
1. ターミナルを開きます
2. 同じコマンドを実行します：

```bash
ruby --version
```

### 1-2. 結果の確認

**成功の場合:**
```
ruby 3.3.0 (2023-12-25 revision xxx) [x86_64-darwin21]
```
のような表示が出れば、Rubyがインストールされています。
バージョンが3.3以上なら、次のステップに進めます。

**失敗の場合:**
```
'ruby' は、内部コマンドまたは外部コマンド、
操作可能なプログラムまたはバッチ ファイルとして認識されていません。
```
このような表示が出た場合は、Rubyをインストールする必要があります。

### 1-3. Rubyのインストール（必要な場合のみ）

**Windowsの場合:**
1. [RubyInstaller](https://rubyinstaller.org/) にアクセス
2. 「Ruby+Devkit 3.3.x」をダウンロード
3. ダウンロードしたファイルを実行してインストール
4. インストール後、再度 `ruby --version` で確認

**Macの場合:**
1. Homebrewを使用（推奨）：
```bash
brew install ruby
```

**Linuxの場合:**
```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install ruby-full

# CentOS/RHEL
sudo yum install ruby
```

**注意点:**
- インストール後は、ターミナル/コマンドプロンプトを一度閉じて開き直してください
- Windowsの場合、パスの設定が必要な場合があります

---

## ステップ2: プロジェクトの取得

### 2-1. Gitのインストール確認

まず、Gitがインストールされているか確認します：

```bash
git --version
```

**成功例:**
```
git version 2.39.0
```

もしGitがインストールされていない場合は、[Git公式サイト](https://git-scm.com/)からダウンロードしてインストールしてください。

### 2-2. プロジェクトのダウンロード

プロジェクトのファイルをあなたのパソコンにダウンロードします：

```bash
git clone https://github.com/keiichi-omosu/redmine_mcp.git
```

### 2-3. プロジェクトフォルダに移動

ダウンロードしたプロジェクトのフォルダに移動します：

```bash
cd redmine_mcp
```

**確認方法:**
以下のコマンドでファイル一覧を表示し、プロジェクトファイルがあることを確認します：

```bash
ls
```

**期待される結果:**
```
Gemfile
Gemfile.lock
README.md
docker-compose.yml
lib/
server.rb
stdio_server.rb
test/
...
```

---

## ステップ3: 依存関係のインストール

### 3-1. Bundlerのインストール

Bundlerは、Rubyプロジェクトで必要なライブラリを管理するツールです：

```bash
gem install bundler
```

### 3-2. プロジェクトの依存関係をインストール

プロジェクトで使用するライブラリをすべてインストールします：

```bash
bundle install
```

**処理時間**: 初回は数分かかる場合があります。

**成功例:**
```
Bundle complete! 8 Gemfile dependencies, 25 gems now installed.
Use `bundle info [gemname]` to see where a bundled gem is installed.
```

**よくあるエラーと対処法:**

**エラー1: Bundlerが見つからない**
```
bundler: command not found
```
→ `gem install bundler` を実行してください

**エラー2: コンパイルエラー**
```
ERROR: Failed to build gem native extension.
```
→ 開発用ツールが不足している可能性があります（Windowsの場合、RubyInstaller+Devkitを使用してください）

---

## ステップ4: Redmine環境の構築

### 4-1. Dockerのインストール確認

Dockerがインストールされているか確認します：

```bash
docker --version
docker-compose --version
```

**成功例:**
```
Docker version 20.10.17
docker-compose version 1.29.2
```

### 4-2. Dockerのインストール（必要な場合）

Dockerがインストールされていない場合：

**Windows/Mac:**
1. [Docker Desktop](https://www.docker.com/products/docker-desktop)をダウンロード
2. インストーラーを実行
3. インストール後、Docker Desktopを起動

**Linux:**
```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install docker.io docker-compose

# インストール後、ユーザーをdockerグループに追加
sudo usermod -aG docker $USER
```

### 4-3. Redmine環境の起動

開発用のRedmine環境をDockerで起動します：

```bash
docker-compose up -d
```

**説明:**
- `-d` オプションにより、バックグラウンドで実行されます
- 初回は数分かかります（Redmineのイメージをダウンロードするため）

**確認方法:**
以下のコマンドで、コンテナが正常に起動していることを確認します：

```bash
docker-compose ps
```

**期待される結果:**
```
       Name                     Command               State                 Ports
------------------------------------------------------------------------------------------
redmine_mcp_db_1        docker-entrypoint.sh mysqld     Up      3306/tcp, 33060/tcp
redmine_mcp_redmine_1   /docker-entrypoint.sh rails ...   Up      0.0.0.0:8080->3000/tcp
redmine_mcp_ruby_1      ruby server.rb                  Up      0.0.0.0:3000->3000/tcp
```

### 4-4. Redmineにアクセス

ブラウザで以下のURLにアクセスします：

```
http://localhost:8080
```

**初回ログイン情報:**
- ユーザー名: `admin`
- パスワード: `admin`

**📷 ここに図解があると良い場所**: Redmineのログイン画面のスクリーンショット

### 4-5. RedmineのAPIキーを取得

1. Redmineにログイン後、右上の「個人設定」をクリック
2. 右側のメニューから「APIアクセスキー」をクリック
3. 「APIアクセスキーを表示」をクリック
4. 表示されたキー（例：`abcd1234efgh5678...`）をコピーして保存

**📷 ここに図解があると良い場所**: APIキー取得手順のスクリーンショット

**重要**: このAPIキーは後で使用するので、メモ帳などに保存しておいてください。

---

## ステップ5: 動作確認

### 5-1. 環境変数の設定

APIキーを設定ファイルに記録します。

**方法1: 環境変数として設定（推奨）**

**Windows（コマンドプロンプト）:**
```cmd
set REDMINE_URL=http://localhost:8080
set REDMINE_API_KEY=ここに先ほどコピーしたAPIキーを貼り付け
```

**Windows（PowerShell）:**
```powershell
$env:REDMINE_URL="http://localhost:8080"
$env:REDMINE_API_KEY="ここに先ほどコピーしたAPIキーを貼り付け"
```

**Mac/Linux:**
```bash
export REDMINE_URL=http://localhost:8080
export REDMINE_API_KEY=ここに先ほどコピーしたAPIキーを貼り付け
```

### 5-2. テスト実行

すべてが正しく設定されているか、テストを実行して確認します：

```bash
bundle exec rake test
```

**成功例:**
```
Run options: --seed 12345

# Running:

............

Finished in 2.345678s, 5.1234 runs/s, 8.9012 assertions/s.

12 runs, 21 assertions, 0 failures, 0 errors, 0 skips
```

**注意点:**
- `0 failures, 0 errors` が表示されれば成功です
- 数値は環境によって異なります

### 5-3. MCPサーバーの起動

いよいよMCPサーバーを起動します：

```bash
ruby server.rb
```

**成功例:**
```
[2024-09-11 15:30:25] INFO  WEBrick 1.7.0
[2024-09-11 15:30:25] INFO  ruby 3.3.0 (2023-12-25) [x86_64-darwin21]
== Sinatra (v3.0.4) has taken the stage on 3000 for development with backup from WEBrick
[2024-09-11 15:30:25] INFO  WEBrick::HTTPServer#start: pid=12345 port=3000
```

### 5-4. 動作確認テスト

別のターミナル/コマンドプロンプトを開いて、MCPサーバーが正常に動作しているかテストします：

```bash
curl -X POST http://localhost:3000/rpc \
     -H "Content-Type: application/json" \
     -d '{"jsonrpc":"2.0","id":1,"method":"tools/list"}'
```

**期待される結果:**
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "result": {
    "tools": [
      {
        "name": "get_redmine_ticket",
        "description": "Redmineからチケット情報を取得します",
        "inputSchema": {
          "type": "object",
          "properties": {
            "ticket_id": {
              "type": "integer",
              "description": "取得したいチケットのID"
            }
          }
        }
      }
    ]
  }
}
```

**Windows/curlがない場合:**
PowerShellで以下を実行：

```powershell
Invoke-RestMethod -Uri "http://localhost:3000/rpc" -Method Post -ContentType "application/json" -Body '{"jsonrpc":"2.0","id":1,"method":"tools/list"}'
```

---

## よくある問題と解決方法

### 問題1: ポートが使用中エラー

**エラー例:**
```
Address already in use - bind(2) for "127.0.0.1" port 3000
```

**解決方法:**
別のプログラムが同じポートを使用しています。使用中のプロセスを確認して終了するか、別のポートを使用してください。

```bash
# 使用中のポートを確認
lsof -i :3000

# プロセスを終了（PIDは上記コマンドで確認）
kill -9 <PID番号>
```

### 問題2: Docker起動エラー

**エラー例:**
```
docker: Cannot connect to the Docker daemon
```

**解決方法:**
1. Docker Desktopが起動しているか確認
2. Dockerサービスが実行されているか確認
3. 管理者権限でターミナルを開いて再実行

### 問題3: Ruby gemインストールエラー

**エラー例:**
```
Your Ruby version is 2.7.0, but your Gemfile specified 3.3
```

**解決方法:**
Rubyのバージョンが古いです。ステップ1に戻ってRuby 3.3以上をインストールしてください。

### 問題4: APIキーが無効

**エラー例:**
```
401 Unauthorized
```

**解決方法:**
1. Redmineが正常に起動しているか確認（http://localhost:8080にアクセス）
2. APIキーが正しくコピーされているか確認
3. RedmineでREST APIが有効になっているか確認

---

## 次のステップ

おめでとうございます！Redmine MCPサーバーのセットアップが完了しました。

### できるようになったこと

- Redmine MCPサーバーを起動できる
- RedmineのチケットをAI経由で取得できる
- 開発環境でテストを実行できる

### 次に学ぶこと

1. **基本的な使い方**: MCPサーバーを使ってRedmineチケットを取得する方法
2. **カスタマイズ**: 独自の機能を追加する方法
3. **デプロイ**: 本番環境での運用方法

### 推奨する次のドキュメント

- [基本的な使い方ガイド](02_基本的な使い方.md) ※次回作成予定
- [開発環境詳細ガイド](../DEVELOPMENT.md) - より詳しい開発環境の説明
- [アーキテクチャドキュメント](../ARCHITECTURE.md) - システムの仕組みを理解したい場合

### 困ったときは

1. [トラブルシューティングガイド](../TROUBLESHOOTING.md)を確認
2. GitHubのIssueで質問
3. プロジェクトのSlackチャンネルで相談

---

## まとめ

このガイドでは以下の手順を実行しました：

✅ Ruby 3.3以上のインストール確認  
✅ プロジェクトファイルのダウンロード  
✅ 必要なライブラリのインストール  
✅ Docker環境でのRedmine起動  
✅ APIキーの取得と設定  
✅ MCPサーバーの起動と動作確認  

何か問題が発生した場合は、各ステップに戻って確認してください。また、この手順で解決しない場合は、遠慮なくサポートチャンネルで質問してください。

良い開発ライフを！ 🚀